<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ì•„ì¹´ë°ë¯¸ì°½ Â· ë‹¤ì“° ë¦¬í¬íŠ¸</title>

<!-- Fonts & Libs -->
<link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/static/woff2/SUIT.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

<style>
:root{
  --brand:#2140B1; --brand-700:#1a2f91;
  --ink:#111827; --muted:#6B7280; --line:rgba(17,24,39,.10);
  --bg:#f7f9ff; --white:#fff; --glass:rgba(255,255,255,.55);
}
*{ box-sizing:border-box; font-family:'SUIT',system-ui,sans-serif; letter-spacing:-.2px }
html,body{ margin:0; color:var(--ink); background:var(--bg) }
a{ color:inherit; text-decoration:none }
.container{ max-width:1180px; margin:0 auto; padding:0 24px }

/* Header */
header{
  position:sticky; top:0; z-index:20; background:rgba(255,255,255,.75);
  backdrop-filter:blur(10px); border-bottom:1px solid var(--line);
}
.nav{ height:66px; display:flex; align-items:center; justify-content:space-between }
.nav-left{ display:flex; align-items:center; gap:10px; font-weight:900 }
.nav-right{ display:flex; gap:16px; align-items:center }
.nav-link{ color:#374151; font-weight:700 }
.nav-link:hover{ color:var(--ink) }

/* Buttons */
.btn{ border:none; height:46px; padding:0 18px; border-radius:14px; font-weight:800; cursor:pointer; transition:.2s }
.btn-primary{ background:var(--brand); color:#fff; box-shadow:0 8px 20px rgba(33,64,177,.18) }
.btn-primary:hover{ transform:translateY(-1px); box-shadow:0 12px 28px rgba(33,64,177,.22) }
.btn-ghost{ background:#fff; border:1px solid #e5e7eb }
.btn-chip{ height:40px; background:#EEF2FF; color:var(--brand-700); border-radius:999px; font-weight:900 }

/* Sections */
.section{ padding:56px 0 }
.section-tight{ padding:36px 0 }
.muted{ color:var(--muted) }
.card{ background:var(--white); border:1px solid #eef2ff; border-radius:18px; padding:18px; box-shadow:0 12px 30px rgba(17,24,39,.06); overflow:hidden }
.badge{ font-weight:900; color:var(--brand-700); background:#EEF2FF; border:1px solid #e6ebff; padding:6px 10px; border-radius:999px; display:inline-flex; align-items:center; gap:6px }

/* HERO */
.hero{
  padding:96px 0 62px;
  background:
    radial-gradient(1200px 600px at 80% -30%, rgba(33,64,177,.22), transparent),
    radial-gradient(900px 500px at -10% 20%, rgba(33,64,177,.12), transparent),
    linear-gradient(180deg, #ffffff 0%, #f7f9ff 60%);
  border-bottom:1px solid var(--line);
}
.hero h1{ margin:0 0 12px; font-size:clamp(36px,6vw,64px); line-height:1.08; font-weight:900 }
.hero p{ margin:0 0 24px; font-size:18px; color:#4b5563 }

/* Feature rows */
.process{ display:grid; grid-template-columns:repeat(4,1fr); gap:16px }
.process .item{ display:flex; flex-direction:column; gap:6px; align-items:center; text-align:center; padding:18px; border-radius:18px;
  background:rgba(255,255,255,.75); backdrop-filter:blur(8px); border:1px solid #eef2ff; box-shadow:0 12px 30px rgba(17,24,39,.06) }
.process .icon{ font-size:22px }
.grid-3{ display:grid; grid-template-columns:repeat(3,1fr); gap:16px }
.grid-4{ display:grid; grid-template-columns:repeat(4,1fr); gap:16px }
@media (max-width:960px){ .process{ grid-template-columns:1fr 1fr } .grid-3{ grid-template-columns:1fr } }
@media (max-width:1100px){ .grid-4{ grid-template-columns:1fr 1fr } }
@media (max-width:640px){ .grid-4{ grid-template-columns:1fr } }

/* Editor */
.panel{ background:var(--glass); backdrop-filter:blur(14px); border:1px solid rgba(255,255,255,.5);
  border-radius:22px; padding:22px; box-shadow:0 10px 30px rgba(17,24,39,.1); overflow:hidden }
.form-label{ font-weight:900; margin:12px 0 6px; display:block }
.input,.textarea{ width:100%; padding:14px 16px; border:1px solid #e5e7eb; border-radius:12px; font-size:16px; line-height:1.6; resize:none }
.input:focus,.textarea:focus{ outline:none; border-color:var(--brand); box-shadow:0 0 0 3px rgba(33,64,177,.18) }
.textarea::placeholder,.input::placeholder{ color:#9CA3AF }
#passages{ display:grid; grid-template-columns:1fr 1fr; gap:14px }
@media (max-width:680px){ #passages{ grid-template-columns:1fr } }
.kpi{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
@media (max-width:900px){ .kpi{ grid-template-columns:1fr } }

.fade{ animation:fadeUp .45s ease }
@keyframes fadeUp{ from{ opacity:0; transform:translateY(8px) } to{ opacity:1; transform:none } }
.hidden{ display:none }
</style>
</head>

<body>
<header>
  <div class="container nav">
    <div class="nav-left" style="gap:10px">
      <div style="width:10px;height:10px;border-radius:50%;background:var(--brand)"></div>
      <span>ì•„ì¹´ë°ë¯¸ì°½</span>
    </div>
    <div class="nav-right">
      <a href="#services" class="nav-link" onclick="scrollToId('services')">ì„œë¹„ìŠ¤</a>
      <a href="#guide" class="nav-link" onclick="scrollToId('guide')">ì´ìš©ì•ˆë‚´</a>
      <a href="#pricing" class="nav-link" onclick="scrollToId('pricing')">ê°€ê²©</a>
      <button class="btn btn-primary" onclick="goToEditor()">AI ì²¨ì‚­í•˜ê¸°</button>
    </div>
  </div>
</header>

<main>
  <!-- ===================== HOME ===================== -->
  <section id="homeSection" class="hero">
    <div class="container">
      <div class="badge">âœ¨ ë…¼ìˆ  AI ì²¨ì‚­ Â· ìƒë‹´ìš© ë¦¬í¬íŠ¸</div>
      <h1>ê¸€ í‰ê°€ì™€ ì˜ˆì‹œ ì‘ì„±,<br/>ë” ì‰½ê³  ê°„í¸í•˜ê²Œ</h1>
      <p>í•™ìƒ ê¸€ ì…ë ¥ â†’ AI í‰ê°€/ê·¸ë˜í”„ â†’ ì œì‹œë¬¸ ê¸°ë°˜ ì˜ˆì‹œë‹µì•ˆ â†’ PDF ì €ì¥ê¹Œì§€, í•œ ë²ˆì—.</p>
      <div style="display:flex; gap:12px; flex-wrap:wrap">
        <button class="btn btn-primary" style="height:52px" onclick="goToEditor()">ì‹œì‘í•˜ê¸°</button>
        <button class="btn btn-ghost" style="height:52px" onclick="scrollToId('services')">ì˜ˆì‹œ ë¯¸ë¦¬ë³´ê¸°</button>
      </div>

      <div class="section-tight"></div>
      <div class="process">
        <div class="item"><div class="icon">âœï¸</div><b>ë…¼ìˆ  ì…ë ¥</b><div class="muted">ì§ˆë¬¸Â·ì œì‹œë¬¸Â·ë…¼ìˆ ë¬¸</div></div>
        <div class="item"><div class="icon">ğŸ“Š</div><b>í‰ê°€ ì¹´ë“œ/ê·¸ë˜í”„</b><div class="muted">ì ìˆ˜ì™€ ê·¼ê±°</div></div>
        <div class="item"><div class="icon">ğŸ’¡</div><b>ì˜ˆì‹œë‹µì•ˆ</b><div class="muted">ì œì‹œë¬¸ë§Œ í™œìš©</div></div>
        <div class="item"><div class="icon">ğŸ“„</div><b>PDF ì €ì¥</b><div class="muted">ê¸°ë¡ ë³´ê´€</div></div>
      </div>
    </div>
  </section>

  <section id="services" class="section">
    <div class="container">
      <h2 style="margin:0 0 8px; font-size:28px; font-weight:900">ë‹¤ì“° ë¦¬í¬íŠ¸, ì™œ ì¢‹ì•„ìš”?</h2>
      <p class="muted" style="margin:0 0 18px">ìƒë‹´ í˜„ì¥ì—ì„œ ë°”ë¡œ ì„¤ë“ ê°€ëŠ¥í•œ ê²°ê³¼ë¬¼ ì¤‘ì‹¬ ì„¤ê³„</p>
      <div class="grid-4">
        <div class="card"><h3 style="margin:0 0 6px">âœ… ì œì‹œë¬¸ ê¸°ë°˜ í‰ê°€</h3><p class="muted">ì™¸ë¶€ ì§€ì‹ ì—†ì´ ì œì‹œë¬¸ë§Œ ê·¼ê±°ë¡œ ì±„ì ê³¼ ì´ìœ  ì œê³µ.</p></div>
        <div class="card"><h3 style="margin:0 0 6px">ğŸ“ˆ í•œëˆˆì— ì´í•´ë˜ëŠ” ë¦¬í¬íŠ¸</h3><p class="muted">ì´ì Â·íŒì •Â·ê²Œì´ì§€Â·ë§‰ëŒ€ê·¸ë˜í”„ê¹Œì§€ ì¦‰ì‹œ ì´í•´.</p></div>
        <div class="card"><h3 style="margin:0 0 6px">ğŸ¯ ê¸°ì¤€ì„  ëª…ì‹œ</h3><p class="muted">40ì  ë§Œì , 30/36 ê¸°ì¤€ìœ¼ë¡œ ê²°ê³¼ í•´ì„ì´ ì‰¬ì›Œìš”.</p></div>
        <div class="card"><h3 style="margin:0 0 6px">ğŸ“¦ PDF ë¦¬í¬íŠ¸</h3><p class="muted">ì´ë¦„Â·ë‚ ì§œÂ·í‰ê°€Â·ì˜ˆì‹œë‹µì•ˆÂ·ë¹„êµë¶„ì„ì„ í•œ íŒŒì¼ë¡œ.</p></div>
      </div>
    </div>
  </section>

  <section id="guide" class="section" style="background:#fff">
    <div class="container">
      <span class="badge">ì´ìš©ì•ˆë‚´</span>
      <h2 style="margin:8px 0 12px; font-size:28px; font-weight:900">1ë¶„ì´ë©´ ì‹œì‘ ê°€ëŠ¥</h2>
      <ul style="margin:10px 0 0 0; padding-left:18px; color:#374151">
        <li><b>í•™ìƒÂ·ì§ˆë¬¸Â·ì œì‹œë¬¸Â·ë…¼ìˆ ë¬¸</b>ì„ ì…ë ¥í•˜ê³  <b>ë¦¬í¬íŠ¸ ìƒì„±</b>ì„ ëˆŒëŸ¬ìš”.</li>
        <li>AIê°€ <b>ë…¼ë¦¬Â·ë…í•´Â·êµ¬ì„±Â·í‘œí˜„</b>ì„ ì ìˆ˜í™”í•˜ê³  ì´ìœ ë¥¼ ì œê³µí•´ìš”.</li>
        <li><b>ì˜ˆì‹œë‹µì•ˆÂ·ë¹„êµë¶„ì„</b>ìœ¼ë¡œ ì„¤ë“ë ¥ ìˆëŠ” ì½”ì¹­ì´ ê°€ëŠ¥í•´ìš”.</li>
        <li>ê²°ê³¼ëŠ” <b>PDF</b>ë¡œ ì €ì¥Â·ê³µìœ í•  ìˆ˜ ìˆì–´ìš”.</li>
      </ul>
      <div style="margin-top:14px"><button class="btn btn-chip" onclick="goToEditor()">ë™ì˜í•˜ê³  ì‹œì‘í•˜ê¸°</button></div>
    </div>
  </section>

  <section id="pricing" class="section-tight">
    <div class="container grid-3">
      <div class="card"><h3 style="margin:0 0 6px">ë² ì´ì§</h3><p class="muted">í•„ìˆ˜ ê¸°ëŠ¥ Â· ê¸°ë³¸ PDF</p><button class="btn btn-primary" style="margin-top:8px" onclick="goToEditor()">ì‹œì‘í•˜ê¸°</button></div>
      <div class="card"><h3 style="margin:0 0 6px">í”„ë¡œ</h3><p class="muted">ë¬´ì œí•œ Â· ë¡œê³ /ë¸Œëœë“œ PDF</p><button class="btn btn-primary" style="margin-top:8px" onclick="goToEditor()">ì‹œì‘í•˜ê¸°</button></div>
      <div class="card"><h3 style="margin:0 0 6px">íŒ€/í•™ì›</h3><p class="muted">ì—¬ëŸ¬ ê³„ì • Â· ëŒ€ì‹œë³´ë“œ</p><button class="btn btn-primary" style="margin-top:8px" onclick="goToEditor()">ì‹œì‘í•˜ê¸°</button></div>
    </div>
  </section>

  <section class="section" style="padding:46px 0 64px">
    <div class="container card" style="text-align:center">
      <h2 style="margin:0 0 10px; font-weight:900">ì§€ê¸ˆ, í•™ìƒì˜ ê¸€ì— ë‚ ê°œë¥¼</h2>
      <p class="muted" style="margin:0 0 16px">ì˜¤ëŠ˜ì˜ ì‘ì€ ìˆ˜ì •ì´, ë‚´ì¼ì˜ í° ë„ì•½ì„ ë§Œë“­ë‹ˆë‹¤.</p>
      <button class="btn btn-primary" style="height:52px" onclick="goToEditor()">AI ì²¨ì‚­í•˜ê¸°</button>
    </div>
  </section>

  <!-- ===================== EDITOR ===================== -->
  <section id="editorSection" class="section hidden">
    <div class="container">
      <div class="panel fade">
        <h2 style="margin:0 0 12px; font-weight:900">âœ¨ ë„ˆì˜ ê¸€, ì˜¤ëŠ˜ ë” ë©€ë¦¬ ë‚ ì•„ê°€ê²Œ.</h2>
        <p class="muted" style="margin-top:0">ì •ì„±ê» ì“´ ë¬¸ì¥ ìœ„ì— í•„ìš”í•œ í”¼ë“œë°±ë§Œ ì–¹ì–´, ëª©í‘œì— ë‹¿ë„ë¡ ë¶€ë“œëŸ½ê²Œ ì´ëŒì–´ ë“œë¦´ê²Œìš”.</p>

        <label class="form-label">í•™ìƒ ì´ë¦„</label>
        <input id="studentName" class="input" placeholder="ì˜ˆ: í™ê¸¸ë™" />

        <label class="form-label">ì§ˆë¬¸</label>
        <textarea id="question" class="textarea" rows="2" placeholder="ì§ˆë¬¸ì„ ì—¬ê¸°ì— ì‘ì„±í•´ ì£¼ì„¸ìš”."></textarea>

        <label class="form-label">ì œì‹œë¬¸ <span class="muted">(ìµœì†Œ 1ê°œ)</span></label>
        <div id="passages">
          <textarea class="passage textarea" rows="3" placeholder="ì œì‹œë¬¸ì„ ê·¸ëŒ€ë¡œ ì ì–´ ì£¼ì„¸ìš”."></textarea>
        </div>
        <div style="display:flex; justify-content:flex-end; margin-top:8px">
          <button type="button" class="btn btn-ghost" onclick="addPassage()">â• ì œì‹œë¬¸ ë” ì¶”ê°€</button>
        </div>

        <label class="form-label">ë…¼ìˆ ë¬¸ <span class="muted">(í•™ìƒ ì‘ì„± ê¸€)</span></label>
        <textarea id="essay" class="textarea" rows="6" placeholder="ì œì‹œë¬¸ë§Œ ê·¼ê±°ë¡œ, ë°°ê²½ì§€ì‹ ì—†ì´ ì‘ì„±í•´ ì£¼ì„¸ìš”." oninput="updateCharCount()"></textarea>
        <div id="charCount" class="muted" style="margin-top:6px"></div>

        <label class="form-label">ê¸€ì ìˆ˜ ì œí•œ</label>
        <div style="display:flex; gap:10px">
          <input id="charLimit" class="input" placeholder="ì˜ˆ: 700" />
          <input id="charRange" class="input" placeholder="Â± ì˜ˆ: 50" />
        </div>

        <div style="margin-top:18px; text-align:center">
          <button class="btn btn-primary" onclick="submitEssay()">âš¡ ë¦¬í¬íŠ¸ë¥¼ ì¤€ë¹„í•˜ê³  ìˆì–´ìš”</button>
        </div>
        <div id="loading" class="muted" style="display:none; margin-top:8px">â³ ì½ê³  ìˆì–´ìš”â€¦ ë¬¸ì¥ ì‚¬ì´ì‚¬ì´ì˜ ì§„ì‹¬ê¹Œì§€ ë†“ì¹˜ì§€ ì•Šì„ê²Œìš”.</div>
        <div id="error" class="muted" style="display:none; color:#dc2626; margin-top:8px">ì ì‹œ ìˆ¨ ê³ ë¥´ëŠ” ì¤‘ì´ì—ìš”. ê³§ ë‹¤ì‹œ ë„ì™€ë“œë¦´ê²Œìš”.</div>
      </div>

      <!-- ê²°ê³¼ -->
      <div id="resultCard" class="panel fade hidden" style="margin-top:18px">
        <h3 style="margin-top:0">ğŸ“Š í•œëˆˆì— ì´í•´ë˜ëŠ” ë¦¬í¬íŠ¸</h3>
        <div id="evalSummary"></div>
      </div>

      <!-- ì˜ˆì‹œ/ë¹„êµ + PDF -->
      <div id="exampleSection" class="panel fade hidden" style="margin-top:18px">
        <h3>ğŸ“ í•œ ê±¸ìŒ ë”, ì´ë ‡ê²Œ ë‹¤ë“¬ì–´ë´¤ì–´ìš”.</h3>
        <div id="exampleOutput" class="card" style="background:#fff"></div>
        <div id="comparisonOutput" class="card" style="background:#fff"></div>
        <button class="btn btn-primary" style="margin-top:14px" onclick="downloadPDF()">ğŸ“¥ PDF ì €ì¥</button>
        <button class="btn btn-ghost" style="margin-top:14px" onclick="resetReport()">ğŸ”„ ìƒˆ ë¦¬í¬íŠ¸ ì‹œì‘</button>
      </div>
    </div>
  </section>
</main>

<script>
/* ===== Router & CTA ===== */
function show(section){
  document.getElementById('homeSection').classList.toggle('hidden', section!=='home');
  document.getElementById('editorSection').classList.toggle('hidden', section!=='editor');
  window.scrollTo({ top:0, behavior:'instant' });
}
function go(section){
  location.hash = (section==='editor' ? '#editor' : '#home');
  show(section);
}
function routeFromHash(){
  const h=(location.hash||'').toLowerCase();
  if(h==='#editor') show('editor'); else show('home');
}
window.addEventListener('hashchange', routeFromHash);
window.addEventListener('DOMContentLoaded', routeFromHash);

// CTA: ë¶€ë“œëŸ¬ìš´ ì´ë™ + í¬ì»¤ìŠ¤
function goToEditor(){
  location.hash = '#editor';
  show('editor');
  setTimeout(() => {
    const target = document.getElementById('studentName');
    target?.focus({ preventScroll: true });
    const y = document.getElementById('editorSection').getBoundingClientRect().top + window.scrollY - 72;
    window.scrollTo({ top: y, behavior: 'smooth' });
  }, 0);
}
function scrollToId(id){ document.getElementById(id)?.scrollIntoView({behavior:'smooth'}); }

/* ===== Editor Logic ===== */
let scoreChart, savedScores=[], savedReasons={}, savedExample="", savedComparison="";

// textarea ìë™ ë¦¬ì‚¬ì´ì¦ˆ
function autoResize(el){ el.style.height='auto'; el.style.height=Math.min(el.scrollHeight, 1200)+'px'; }
function bindAutoResize(){
  document.querySelectorAll('textarea').forEach(t=>{
    t.addEventListener('input', ()=>autoResize(t)); autoResize(t);
  });
}
window.addEventListener('DOMContentLoaded', bindAutoResize);

function addPassage(){
  const t=document.createElement('textarea');
  t.className='passage textarea'; t.rows=3; t.placeholder='ì œì‹œë¬¸ì„ ê·¸ëŒ€ë¡œ ì ì–´ ì£¼ì„¸ìš”.';
  document.getElementById('passages').appendChild(t);
  t.addEventListener('input', ()=>autoResize(t)); autoResize(t);
}
function updateCharCount(){
  const essay=document.getElementById('essay').value;
  document.getElementById('charCount').innerText=`í˜„ì¬ ê¸€ì ìˆ˜: ${essay.length}`;
}

function getTotalAndStatus(scores){
  const total=(scores||[]).reduce((a,b)=>a+(parseInt(b)||0),0);
  let status={label:"ì˜ˆë¹„",desc:"ì¡°ê¸ˆë§Œ ë‹¤ë“¬ìœ¼ë©´ ë” ì¢‹ì•„ì ¸ìš”.",emoji:"ğŸ™‚",tone:"#f59e0b"};
  if(total<30) status={label:"ë‹¤ì‹œ ì“°ê¸°",desc:"ë‹¤ìŒ ì‹œë„ì—ì„œ ë” ë‹¨ë‹¨í•´ì§ˆ ê±°ì˜ˆìš”.",emoji:"ğŸ˜…",tone:"#ef4444"};
  else if(total>=36) status={label:"í•©ê²©",desc:"ì§€ê¸ˆë„ ì¶©ë¶„íˆ ì„¤ë“ë ¥ ìˆì–´ìš”!",emoji:"ğŸ¥³",tone:"#10b981"};
  return { total, status };
}

async function submitEssay(){
  document.getElementById('loading').style.display='block';
  document.getElementById('error').style.display='none';
  try{
    const name=document.getElementById('studentName').value;
    const question=document.getElementById('question').value;
    const passages=[...document.querySelectorAll('.passage')].map(p=>p.value);
    const essay=document.getElementById('essay').value;
    const limit=document.getElementById('charLimit').value;
    const range=document.getElementById('charRange').value;

    const r=await fetch('/review',{method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({name,question,passages,essay,limit,range})});
    const data=await r.json();
    savedScores=data.scores; savedReasons=data.reasons;

    const { total, status } = getTotalAndStatus(savedScores);
    const progress=`
      <div style="margin-top:8px">
        <div style="position:relative;height:10px;background:#eef2ff;border-radius:999px;overflow:hidden">
          <div style="width:${(total/40)*100}%;height:100%;background:${status.tone};transition:width .5s"></div>
          <div style="position:absolute;left:${(30/40)*100}%;top:0;bottom:0;width:2px;background:rgba(17,24,39,.15)"></div>
          <div style="position:absolute;left:${(36/40)*100}%;top:0;bottom:0;width:2px;background:rgba(17,24,39,.25)"></div>
        </div>
        <div class="muted" style="display:flex;justify-content:space-between;font-size:12px;margin-top:6px">
          <span>0</span><span>30(ì˜ˆë¹„)</span><span>36(í•©ê²©)</span><span>40</span>
        </div>
      </div>`;

    // ì‹œê° ë¦¬í¬íŠ¸ ë¸”ë¡
    document.getElementById('evalSummary').innerHTML=`
      <div class="card" style="display:flex;align-items:center;gap:14px">
        <div style="font-size:30px">${status.emoji}</div>
        <div style="flex:1">
          <div style="font-weight:900">ì´ì  <span style="color:${status.tone}">${total}</span> / 40 Â·
            <span style="color:${status.tone}">${status.label}</span></div>
          <div class="muted" style="margin-top:4px">${status.desc}</div>
          ${progress}
        </div>
        <div style="position:relative; width:110px; height:110px">
          <svg width="110" height="110">
            <circle r="52" cx="55" cy="55" fill="transparent" stroke="#eef2ff" stroke-width="10"></circle>
            <circle r="52" cx="55" cy="55" fill="transparent" stroke="${status.tone}" stroke-width="10"
              stroke-dasharray="327" stroke-dashoffset="${327-(327*(total/40))}"></circle>
          </svg>
          <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-weight:900">${total}</div>
        </div>
      </div>

      <div class="kpi" style="margin-top:14px">
        ${['ë…¼ë¦¬ë ¥','ë…í•´ë ¥','êµ¬ì„±ë ¥','í‘œí˜„ë ¥'].map((k,i)=>`
          <div class="card">
            <div style="font-weight:800">${k} (${savedScores[i]}ì )</div>
            <div class="muted" style="margin-top:6px">${savedReasons[k]}</div>
          </div>
        `).join('')}
      </div>

      <div style="margin-top:18px"><canvas id="scoreChart" height="140"></canvas></div>
    `;

    // Chart (height=140, barThickness=28, categoryPercentage=0.65)
    const ctx=document.getElementById('scoreChart').getContext('2d');
    if(scoreChart) scoreChart.destroy();
    scoreChart=new Chart(ctx,{
      type:'bar',
      data:{
        labels:['ë…¼ë¦¬ë ¥','ë…í•´ë ¥','êµ¬ì„±ë ¥','í‘œí˜„ë ¥'],
        datasets:[{
          data:savedScores,
          backgroundColor:"rgba(33,64,177,.75)",
          borderRadius:8,
          barThickness:28,
          categoryPercentage:0.65
        }]
      },
      options:{
        animation:{duration:600,easing:'easeOutQuart'},
        scales:{
          x:{grid:{display:false},ticks:{color:'#6B7280',font:{size:12}}},
          y:{beginAtZero:true,max:10,ticks:{stepSize:1,color:'#9CA3AF',font:{size:11}},
             grid:{color:'rgba(17,24,39,.06)'}}
        },
        plugins:{legend:{display:false},tooltip:{enabled:true}}
      }
    });

    document.getElementById('loading').style.display='none';
    document.getElementById('resultCard').classList.remove('hidden');

    // Example & Comparison
    const r2=await fetch('/example',{method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({name,question,passages,essay})});
    const data2=await r2.json();
    savedExample=data2.example; savedComparison=data2.comparison;
    document.getElementById('exampleOutput').innerHTML=savedExample.replace(/\n/g,'<br>');
    document.getElementById('comparisonOutput').innerHTML=savedComparison.replace(/\n/g,'<br>');
    document.getElementById('exampleSection').classList.remove('hidden');

  }catch(e){
    console.error(e);
    document.getElementById('loading').style.display='none';
    document.getElementById('error').style.display='block';
  }
}

/* ===== PDF (í™”ë©´ êµ¬ì„± ê·¸ëŒ€ë¡œ) ===== */
function downloadPDF(){
  const name=document.getElementById('studentName').value || 'ì´ë¦„ ë¯¸ì…ë ¥';
  const essay=document.getElementById('essay').value || '';
  const today=new Date().toISOString().split('T')[0];
  const { total, status } = getTotalAndStatus(savedScores);

  // ì°¨íŠ¸ ì´ë¯¸ì§€ë¡œ ë³€í™˜
  let chartImg=''; try{
    const canvas=document.getElementById('scoreChart');
    if(canvas) chartImg=canvas.toDataURL('image/png',1.0);
  }catch(e){ console.warn('chart to image fail',e); }

  const html=`
  <div style="font-family:'SUIT',system-ui,-apple-system,sans-serif; color:#111827;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <h2 style="margin:0">ë‹¤ì“° ë¦¬í¬íŠ¸</h2>
      <div style="color:#6b7280;font-size:12px">í•™ìƒ: ${name} Â· ë‚ ì§œ: ${today}</div>
    </div>

    <div style="display:flex;gap:12px;align-items:center;border:1px solid #e5e7eb;border-radius:12px;padding:12px;">
      <div style="font-size:26px">${status.emoji}</div>
      <div style="flex:1">
        <div style="font-weight:900">ì´ì  <span style="color:${status.tone}">${total}</span> / 40 Â·
          <span style="color:${status.tone}">${status.label}</span></div>
        <div style="color:#6b7280;font-size:13px;margin-top:4px">${status.desc}</div>
        <div style="margin-top:8px;position:relative;height:8px;background:#eef2ff;border-radius:999px;overflow:hidden">
          <div style="width:${(total/40)*100}%;height:100%;background:${status.tone}"></div>
          <div style="position:absolute;left:${(30/40)*100}%;top:0;bottom:0;width:2px;background:rgba(17,24,39,.18)"></div>
          <div style="position:absolute;left:${(36/40)*100}%;top:0;bottom:0;width:2px;background:rgba(17,24,39,.28)"></div>
        </div>
        <div style="display:flex;justify-content:space-between;color:#9ca3af;font-size:11px;margin-top:4px">
          <span>0</span><span>30(ì˜ˆë¹„)</span><span>36(í•©ê²©)</span><span>40</span>
        </div>
      </div>
      <div style="position:relative;width:110px;height:110px">
        <svg width="110" height="110">
          <circle r="52" cx="55" cy="55" fill="transparent" stroke="#eef2ff" stroke-width="10"></circle>
          <circle r="52" cx="55" cy="55" fill="transparent" stroke="${status.tone}" stroke-width="10"
            stroke-dasharray="327" stroke-dashoffset="${327-(327*(total/40))}"></circle>
        </svg>
        <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-weight:900">${total}</div>
      </div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px">
      ${['ë…¼ë¦¬ë ¥','ë…í•´ë ¥','êµ¬ì„±ë ¥','í‘œí˜„ë ¥'].map((k,i)=>`
        <div style="border:1px solid #e5e7eb;border-radius:12px;padding:12px">
          <div style="font-weight:800">${k} (${savedScores[i]}ì )</div>
          <div style="color:#6b7280;font-size:13px;margin-top:6px">${savedReasons[k]}</div>
        </div>
      `).join('')}
    </div>

    ${chartImg ? `<div style="margin-top:12px;border:1px solid #e5e7eb;border-radius:12px;padding:12px">
      <img src="${chartImg}" style="width:100%;height:auto;display:block;"/></div>` : ''}

    <h3 style="margin:16px 0 6px">ì‘ì„±í•œ ë…¼ìˆ ë¬¸</h3>
    <div style="border:1px solid #e5e7eb;border-radius:12px;padding:12px;font-size:13px;color:#374151">
      ${essay.replace(/\n/g,'<br>')}
    </div>

    <h3 style="margin:16px 0 6px">ì˜ˆì‹œë‹µì•ˆ</h3>
    <div style="border:1px solid #e5e7eb;border-radius:12px;padding:12px;font-size:13px;color:#374151">
      ${savedExample.replace(/\n/g,'<br>')}
    </div>

    <h3 style="margin:16px 0 6px">ë¹„êµ ë¶„ì„</h3>
    <div style="border:1px solid #e5e7eb;border-radius:12px;padding:12px;font-size:13px;color:#374151">
      ${savedComparison.replace(/\n/g,'<br>')}
    </div>
  </div>`;

  const wrap=document.createElement('div');
  wrap.innerHTML=html;
  html2pdf().from(wrap).set({
    margin:10, filename:`ë‹¤ì“°_ë¦¬í¬íŠ¸_${today}.pdf`,
    html2canvas:{ scale:2, useCORS:true },
    jsPDF:{ unit:'mm', format:'a4', orientation:'portrait' }
  }).save();
}

function resetReport(){ location.hash='#home'; routeFromHash(); }
</script>
</body>
</html>
