<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>아카데미창 · 다쓰 리포트</title>

<style>
/* ======================================================
   Noto Sans KR (PDF 전용 로컬 폰트)
   ====================================================== */
@font-face {
  font-family: 'Noto Sans KR';
  src: url('/static/fonts/NotoSansKR-Regular.ttf') format('truetype');
  font-weight: 400;
}
@font-face {
  font-family: 'Noto Sans KR';
  src: url('/static/fonts/NotoSansKR-Medium.ttf') format('truetype');
  font-weight: 500;
}
@font-face {
  font-family: 'Noto Sans KR';
  src: url('/static/fonts/NotoSansKR-Bold.ttf') format('truetype');
  font-weight: 700;
}
/* ======================================================
   A4 기본 설정
   ====================================================== */
@page{
  size:A4;
  margin:22mm 20mm;
}

:root{
  --brand:#2140B1;
  --brand-700:#1a2f91;
  --ink:#111827;
  --muted:#6B7280;
  --line:rgba(17,24,39,.10);
  --soft:rgba(33,64,177,.06);
  --soft-2:rgba(33,64,177,.10);
  --paper:#ffffff;
  --bg:#f7f9ff; /* 웹 톤과 맞춘 아주 옅은 배경 */
}

html, body{
  margin:0;
  padding:0;
  background:var(--paper);
  color:var(--ink);
  font-family:'Noto Sans KR', sans-serif;
  line-height:1.78;
  -webkit-print-color-adjust: exact;
  print-color-adjust: exact;
}

/* ======================================================
   페이지 분할 (구조적 page-break)
   ====================================================== */
.page{
  page-break-after:always;
  break-after:page;
}
.page:last-child{
  page-break-after:auto;
  break-after:auto;
}

/* ======================================================
   문서 공통: 헤더/푸터/타이포
   ====================================================== */
.topbar{
  height:4mm;
  background:linear-gradient(90deg, var(--brand), rgba(33,64,177,.55));
  border-radius:999px;
  margin-bottom:10mm;
}

.header{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:12px;
  margin-bottom:10mm;
}

.brandblock{
  display:flex;
  flex-direction:column;
  gap:3px;
}

.brandname{
  font-weight:900;
  font-size:12px;
  letter-spacing:.6px;
  color:var(--brand);
}

.brandmeta{
  font-size:11px;
  color:var(--muted);
}

.header-right{
  text-align:right;
}

.doclabel{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(17,24,39,.12);
  background:rgba(255,255,255,.9);
  font-size:11px;
  color:var(--muted);
}

.dot{
  width:6px; height:6px; border-radius:50%;
  background:rgba(33,64,177,.65);
}

.footer{
  margin-top:12mm;
  padding-top:6px;
  border-top:1px solid rgba(17,24,39,.12);
  display:flex;
  justify-content:space-between;
  font-size:11px;
  color:var(--muted);
}

/* 제목 계층 */
.h1{
  font-size:23px;
  font-weight:700;
  letter-spacing:-0.02em;
}

.h2{
  font-size:16px;
  font-weight:900;
  letter-spacing:-.2px;
  margin:0 0 6px 0;
}

.section-title{
  display:flex;
  align-items:center;
  gap:8px;
  margin:0 0 10px 0;
  font-size:15px;
  font-weight:900;
  letter-spacing:-.2px;
}
.section-title .bar{
  width:4px;
  height:16px;
  background:var(--brand);
  border-radius:4px;
}

/* ======================================================
   카드/그리드 (웹 톤 유지 + 인쇄 안정)
   ====================================================== */
.card{
  border:1px solid rgba(17,24,39,.10);
  border-radius:12px;
  padding:14px 14px;
  background:#fff;
}

.card.soft{
  background:linear-gradient(180deg, rgba(33,64,177,.045), rgba(255,255,255,1) 55%);
  border-color:rgba(33,64,177,.14);
}

.muted{
  color:var(--muted);
  font-size:12px;
}

.grid-2{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}

.grid-3{
  display:grid;
  grid-template-columns:1fr 1fr 1fr;
  gap:12px;
}

.badge{
  display:inline-flex;
  align-items:center;
  gap:6px;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(33,64,177,.20);
  background:rgba(33,64,177,.06);
  font-size:11px;
  color:var(--brand-700);
  font-weight:800;
}

/* 정보 KPI */
.kpi{
  text-align:left;
  padding:12px 12px;
}
.kpi .label{
  font-size:11px;
  color:var(--muted);
  margin-bottom:4px;
}
.kpi .value{
  font-size:16px;
  font-weight:950;
  letter-spacing:-.2px;
}
.kpi .sub{
  margin-top:4px;
  font-size:11px;
  color:var(--muted);
}

/* ======================================================
   본문(제시문/논술문) 가독성
   ====================================================== */
.graybox{
  background:rgba(17,24,39,.03);
  border:1px solid rgba(17,24,39,.06);
  border-radius:12px;
  padding:12px 12px;
}

pre{
  margin:0;
  white-space:pre-wrap;
  word-break:break-word;
  font-family:inherit;
  line-height:1.9;
}

/* 살짝 “문서” 느낌 주는 인용/총평 박스 */
.quote{
  border-left:4px solid rgba(33,64,177,.40);
  padding-left:10px;
  color:#1f2937;
}

/* ======================================================
   점수 분석(컨설팅 느낌 + 웹 톤)
   ====================================================== */
.score-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}

.score-card{
  border:1px solid rgba(17,24,39,.10);
  border-radius:12px;
  padding:14px 14px;
  background:linear-gradient(180deg, rgba(33,64,177,.055), #fff 55%);
}

.score-head{
  display:flex;
  justify-content:space-between;
  align-items:flex-end;
  gap:10px;
  margin-bottom:8px;
}

.score-name{
  font-size:13px;
  font-weight:900;
  letter-spacing:-.2px;
}

.score-num{
  font-size:22px;
  font-weight:950;
  color:var(--brand);
  letter-spacing:-.4px;
  line-height:1.0;
}

.score-scale{
  font-size:11px;
  color:var(--muted);
  margin-top:2px;
}

.reason{
  margin-top:6px;
  font-size:12.6px;
  color:#374151;
  line-height:1.75;
}

/* 예시/비교는 ‘자료’ 톤 구분 */
.reference{
  background:rgba(33,64,177,.035);
  border:1px solid rgba(33,64,177,.10);
  border-radius:12px;
  padding:12px 12px;
}
.explain{
  background:rgba(17,24,39,.02);
  border:1px dashed rgba(17,24,39,.14);
  border-radius:12px;
  padding:12px 12px;
}

/* ======================================================
   작은 디테일
   ====================================================== */
.hr{
  height:1px;
  background:rgba(17,24,39,.10);
  margin:10px 0;
}

.smallcap{
  font-size:11px;
  color:var(--muted);
  letter-spacing:.4px;
}
</style>
</head>

<body>

<!-- =================== PAGE 1 : COVER / SUMMARY =================== -->
<div class="page">

  <div class="topbar"></div>

  <div class="header">
    <div class="brandblock">
      <div class="brandname">아카데미창 · 다쓰 리포트</div>
      <div class="brandmeta">상담용 분석 보고서 · Essay Capability Report</div>
    </div>

    <div class="header-right">
      <div class="doclabel">
        <span class="dot"></span>
        Confidential
      </div>
      <div class="muted" style="margin-top:6px;">
        {{ payload.created_at or "테스트 모드" }}
      </div>
    </div>
  </div>

  <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:12px; margin-bottom:12px;">
    <div>
      <div class="h1">{{ payload.student or "학생" }} 학생 분석 리포트</div>
      <div class="muted">논술 역량 종합 진단 · 기준: 논리력/독해력/구성력/표현력</div>
    </div>
    {% if payload.status_label %}
      <div class="badge">{{ payload.status_label }}</div>
    {% endif %}
  </div>

  <div class="grid-3" style="margin-top:14px;">
    <div class="card kpi">
      <div class="label">작성일</div>
      <div class="value">{{ payload.created_at or "-" }}</div>
      <div class="sub">리포트 생성 기준 일자</div>
    </div>

    <div class="card kpi soft">
      <div class="label">총점</div>
      <div class="value">{{ payload.total or "-" }} <span class="muted" style="font-weight:800;">/ 40</span></div>
      <div class="sub">{{ payload.status_desc or "총점은 4개 기준 합산 점수입니다." }}</div>
    </div>

    <div class="card kpi">
      <div class="label">평가 요약</div>
      <div class="value">{{ payload.status_label or "진단 완료" }}</div>
      <div class="sub">상담용 핵심 요약 지표</div>
    </div>
  </div>

  <div class="grid-2" style="margin-top:12px;">
    <div class="card">
      <div class="section-title"><span class="bar"></span>질문</div>
      <div>{{ payload.question or "-" }}</div>
      <div class="hr"></div>
      <div class="muted">문항 의도에 대한 답변 충실도와 제시문 기반 논증을 중심으로 평가합니다.</div>
    </div>

    <div class="card soft">
      <div class="section-title"><span class="bar"></span>한 줄 총평</div>
      <div class="quote">{{ payload.summary or "-" }}</div>
      <div class="hr"></div>
      <div class="muted">총평은 상담 시 “핵심 메시지”로 활용할 수 있도록 요약 형태로 제공됩니다.</div>
    </div>
  </div>

  <div class="footer">
    <div>Generated by 다쓰 리포트</div>
    <div>Page 1</div>
  </div>

</div>


<!-- =================== PAGE 2 : SOURCE (PASSAGES + ESSAY) =================== -->
<div class="page">

  <div class="topbar"></div>

  <div class="header">
    <div class="brandblock">
      <div class="brandname">원자료 · 제시문 및 학생 논술문</div>
      <div class="brandmeta">Source Texts & Student Essay</div>
    </div>
    <div class="header-right">
      <div class="doclabel">
        <span class="dot"></span>
        {{ payload.student or "학생" }}
      </div>
      <div class="muted" style="margin-top:6px;">{{ payload.created_at or "-" }}</div>
    </div>
  </div>

  <div class="section-title"><span class="bar"></span>제시문</div>

  {% if payload.passages %}
    {% for p in payload.passages %}
      <div class="graybox" style="margin-bottom:10px;">
        <div class="smallcap">PASSAGE {{ loop.index }}</div>
        <pre>{{ p }}</pre>
      </div>
    {% endfor %}
  {% else %}
    <div class="graybox">
      <div class="muted">제시문이 제공되지 않았습니다.</div>
    </div>
  {% endif %}

  <div style="height:6px;"></div>

  <div class="section-title"><span class="bar"></span>학생 논술문</div>

  <div class="card" style="padding:16px 16px;">
    <div class="muted" style="margin-bottom:8px;">
      가독성을 위해 줄간격/여백을 최적화해 출력합니다.
    </div>
    <pre>{{ payload.essay or "-" }}</pre>
  </div>

  <div class="footer">
    <div>아카데미창 · 다쓰 리포트</div>
    <div>Page 2</div>
  </div>

</div>


<!-- =================== PAGE 3 : ANALYSIS (SCORES + EXAMPLE + COMPARISON) =================== -->
<div class="page">

  <div class="topbar"></div>

  <div class="header">
    <div class="brandblock">
      <div class="brandname">분석 · 점수 및 피드백</div>
      <div class="brandmeta">Score Analysis & Feedback</div>
    </div>
    <div class="header-right">
      <div class="doclabel">
        <span class="dot"></span>
        {{ payload.student or "학생" }}
      </div>
      <div class="muted" style="margin-top:6px;">{{ payload.created_at or "-" }}</div>
    </div>
  </div>

  <div class="section-title"><span class="bar"></span>세부 점수 분석</div>

  {% set s = payload.scores or [] %}
  {% set r = payload.reasons or {} %}

  <div class="score-grid">
    <div class="score-card">
      <div class="score-head">
        <div>
          <div class="score-name">논리력</div>
          <div class="score-scale">논제가 묻는 것에 답했는가 · 주장/근거의 연결</div>
        </div>
        <div style="text-align:right;">
          <div class="score-num">{{ s[0] if s|length > 0 else "-" }}점</div>
          <div class="muted">/ 10</div>
        </div>
      </div>
      <div class="reason">{{ r["논리력"] if r and ("논리력" in r) else "-" }}</div>
    </div>

    <div class="score-card">
      <div class="score-head">
        <div>
          <div class="score-name">독해력</div>
          <div class="score-scale">제시문 기반 구성 · 해석의 정확성</div>
        </div>
        <div style="text-align:right;">
          <div class="score-num">{{ s[1] if s|length > 1 else "-" }}점</div>
          <div class="muted">/ 10</div>
        </div>
      </div>
      <div class="reason">{{ r["독해력"] if r and ("독해력" in r) else "-" }}</div>
    </div>

    <div class="score-card">
      <div class="score-head">
        <div>
          <div class="score-name">구성력</div>
          <div class="score-scale">문단 구분 · 흐름의 자연스러움 · 들여쓰기</div>
        </div>
        <div style="text-align:right;">
          <div class="score-num">{{ s[2] if s|length > 2 else "-" }}점</div>
          <div class="muted">/ 10</div>
        </div>
      </div>
      <div class="reason">{{ r["구성력"] if r and ("구성력" in r) else "-" }}</div>
    </div>

    <div class="score-card">
      <div class="score-head">
        <div>
          <div class="score-name">표현력</div>
          <div class="score-scale">문법/맞춤법 · 어휘 선택 · 문장 완성도</div>
        </div>
        <div style="text-align:right;">
          <div class="score-num">{{ s[3] if s|length > 3 else "-" }}점</div>
          <div class="muted">/ 10</div>
        </div>
      </div>
      <div class="reason">{{ r["표현력"] if r and ("표현력" in r) else "-" }}</div>
    </div>
  </div>

  <!-- (선택) 그래프 이미지가 payload에 있으면 삽입 가능:
       payload.chart_image_url 또는 payload.chart_base64 등을 쓰는 구조로 확장 가능 -->
  {% if payload.chart_image_url %}
    <div class="card" style="margin-top:10px;">
      <div class="section-title"><span class="bar"></span>시각화</div>
      <div class="muted" style="margin-bottom:8px;">점수 분포를 시각화한 그래프입니다.</div>
      <img src="{{ payload.chart_image_url }}" alt="score chart" style="max-width:100%; border:1px solid rgba(17,24,39,.08); border-radius:12px;">
    </div>
  {% endif %}

  <div class="section-title" style="margin-top:14px;"><span class="bar"></span>예시답안</div>
  <div class="reference">
    <pre>{{ payload.example or "-" }}</pre>
  </div>

  <div class="section-title" style="margin-top:14px;"><span class="bar"></span>비교 설명</div>
  <div class="explain">
    <pre>{{ payload.comparison or "-" }}</pre>
  </div>

  <div class="footer">
    <div>아카데미창 · 다쓰 리포트</div>
    <div>Page 3</div>
  </div>

</div>

</body>
</html>