<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>다쓰 리포트</title>

<style>

@page {
  size: A4;
  margin: 20mm;
}

body {
  background: white !important;
  font-family: sans-serif;
  font-size: 14px;
  line-height: 1.6;
  color: #111827;
}

.page {
  page-break-after: always;
  break-after: page;
}

.page:last-child {
  page-break-after: auto;
  break-after: auto;
}

h1, h2 {
  margin-bottom: 10px;
}

.section {
  margin-top: 20px;
}

.score-box {
  border: 1px solid #e5e7eb;
  padding: 10px;
  margin-bottom: 8px;
  border-radius: 8px;
}

</style>
</head>

<body>

<!-- ======================= 1페이지 ======================= -->
<div class="page">
  <h1>다쓰 리포트</h1>

  <p><strong>이름:</strong> {{ payload.student or payload.name }}</p>
  <p><strong>작성일:</strong> {{ report.created_at if report else "테스트 모드" }}</p>

  <div class="section">
    <h2>질문</h2>
    <p>{{ payload.question }}</p>
  </div>

  <div class="section">
    <h2>학생 논술문</h2>
    <p style="white-space: pre-line;">{{ payload.essay }}</p>
  </div>
</div>

<!-- ======================= 2페이지 ======================= -->
<div class="page">
  <h2>점수 분석</h2>

  {% if payload.scores %}
    <div class="score-box">
      <strong>논리력:</strong> {{ payload.scores[0] }}
    </div>
    <div class="score-box">
      <strong>독해력:</strong> {{ payload.scores[1] }}
    </div>
    <div class="score-box">
      <strong>구성력:</strong> {{ payload.scores[2] }}
    </div>
    <div class="score-box">
      <strong>표현력:</strong> {{ payload.scores[3] }}
    </div>
  {% else %}
    <p>점수 데이터가 없습니다.</p>
  {% endif %}

  <div class="section">
    <h2>총평</h2>
    <p>{{ payload.summary }}</p>
  </div>
</div>

<!-- ======================= 3페이지 ======================= -->
<div class="page">
  <h2>예시 답안</h2>
  <p style="white-space: pre-line;">
    {{ payload.example }}
  </p>

  <div class="section">
    <h2>비교 설명</h2>
    <p style="white-space: pre-line;">
      {{ payload.comparison }}
    </p>
  </div>
</div>

<script>
window.addEventListener("load", async () => {

  if (document.fonts) {
    await document.fonts.ready;
  }

  const images = Array.from(document.images);
  await Promise.all(
    images.map(img => {
      if (img.complete) return Promise.resolve();
      return new Promise(res => {
        img.onload = img.onerror = res;
      });
    })
  );

  await new Promise(r => setTimeout(r, 300));

  window.__PDF_READY__ = true;
});
</script>

</body>
</html>